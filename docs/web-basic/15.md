# 15、堆和栈的区别

::: tip 总结

- **栈**：用于存储 **基本数据类型** 和**函数调用栈（指向堆的指针）**，内存分配连续，生命周期短，访问速度快。
- **堆**：用于存储**引用数据类型**，内存分配不连续，生命周期长，访问速度较慢。

:::

在 JavaScript 中，**堆（Heap）** 和 **栈（Stack）** 是两种不同的内存分配机制，用于存储和管理数据。它们的主要区别在于存储的内容、生命周期以及访问方式。以下是堆和栈的详细对比：

### 1. **栈（Stack）**

| 特点     | 介绍                                                                                                                                                            |
| -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 存储内容 | 栈用于存储**基本数据类型**（如 `number`、`string`、`boolean`、`null`、`undefined`、`symbol`）以及**函数的调用栈**（如函数调用时的局部变量、参数、返回地址等）。 |
| 内存分配 | 栈的内存分配是连续的，由系统自动管理。                                                                                                                          |
| 生命周期 | 栈中的数据生命周期与函数的执行周期一致。当函数执行完毕，栈中的数据会自动释放。                                                                                  |
| 访问速度 | 栈的访问速度非常快，因为内存是连续的，且大小固定。                                                                                                              |
| 大小限制 | 栈的大小通常较小（由系统或浏览器限制），如果栈空间不足，会导致 **栈溢出（Stack Overflow）**。                                                                   |

#### 示例：

```javascript
function foo() {
  let a = 10; // `a` 存储在栈中
  let b = 20; // `b` 存储在栈中
  return a + b;
}
// foo在栈里，值是一个指针，指向堆
foo(); // 函数执行完毕后，`a` 和 `b` 从栈中释放
```

### 2. **堆（Heap）**

#### 特点：

- **存储内容**：
  - 堆用于存储**引用数据类型**（如对象、数组、函数等）。
- **内存分配**：
  - 堆的内存分配是不连续的，由开发者或垃圾回收机制管理。
- **生命周期**：
  - 堆中的数据生命周期不确定，直到没有任何引用指向它时，才会被垃圾回收机制回收。
- **访问速度**：
  - 堆的访问速度较慢，因为内存是不连续的，需要通过指针（引用）访问。
- **大小限制**：
  - 堆的大小通常较大，可以动态分配内存。

#### 示例：

```javascript
let obj = { name: "Alice", age: 25 }; // `obj` 的引用存储在栈中，实际对象存储在堆中
let arr = [1, 2, 3]; // `arr` 的引用存储在栈中，实际数组存储在堆中
```

---

### 3. **堆和栈的区别总结**

| 特性         | 栈（Stack）                  | 堆（Heap）                         |
| ------------ | ---------------------------- | ---------------------------------- |
| **存储内容** | 基本数据类型、函数调用栈     | 引用数据类型（对象、数组等）       |
| **内存分配** | 连续内存，系统自动管理       | 不连续内存，动态分配               |
| **生命周期** | 与函数执行周期一致，自动释放 | 由垃圾回收机制管理，生命周期不确定 |
| **访问速度** | 快                           | 慢                                 |
| **大小限制** | 较小，容易栈溢出             | 较大，可以动态扩展                 |
| **管理方式** | 系统自动管理                 | 开发者或垃圾回收机制管理           |

### 4. **堆和栈的协作**

- 在 JavaScript 中，栈和堆是协同工作的：
  - **栈**存储基本数据类型和引用类型的指针（地址）。
  - **堆**存储引用类型的实际数据。
- 例如：
  ```javascript
  let a = 10; // `a` 是基本数据类型，存储在栈中
  let b = { name: "Bob" }; // `b` 是引用类型，`b` 的指针存储在栈中，实际对象存储在堆中
  ```

### 5. **垃圾回收机制**

- **栈**：栈中的数据在函数执行完毕后会自动释放，无需垃圾回收。
- **堆**：堆中的数据由垃圾回收机制（如 V8 引擎的标记-清除算法）管理，当对象不再被引用时，会被回收。

### 6. **实际应用中的注意事项**

- **栈溢出**：
  - 如果递归调用过深，可能导致栈溢出。
  - 解决方法：将递归改为循环，或使用尾递归优化。
- **内存泄漏**：
  - 如果堆中的对象不再使用但仍被引用，会导致内存泄漏。
  - 解决方法：及时释放不再使用的对象引用。
